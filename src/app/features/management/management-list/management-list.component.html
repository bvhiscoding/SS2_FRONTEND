<div class="min-h-screen bg-gradient-to-br from-teal-50 to-blue-50 p-6 md:p-10">
  <!-- Page Header -->
  <div class="flex flex-wrap items-center justify-between mb-8">
    <div class="flex items-center mb-4 md:mb-0">
      <div class="bg-primary p-3 rounded-lg shadow-lg mr-4">
        <i class="fas fa-users text-white text-xl"></i>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-gray-800">
          {{ "UserManagement.title" | translate }}
        </h1>
        <p class="text-gray-500 mt-1">
          {{ "UserManagement.description" | translate }}
        </p>
      </div>
    </div>
    <button
      (click)="handelOpenPopUpAddManagement()"
      class="bg-primary text-white px-4 py-3 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2 hover:-translate-y-1"
    >
      <i class="fas fa-user-plus"></i>
      <span>{{ "UserManagement.addNewUser" | translate }}</span>
    </button>
  </div>

  <!-- Search & Filter Panel -->
  <div
    class="bg-white rounded-xl shadow-lg p-6 mb-8 transition-all hover:shadow-xl"
  >
    <h2 class="text-lg font-medium text-gray-700 mb-4 flex items-center">
      <i class="fas fa-filter text-primary mr-2"></i>
      <span>{{ "UserManagement.searchAndFilter" | translate }}</span>
    </h2>

    <form
      [formGroup]="form"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4"
    >
      <!-- Name field -->
      <div class="form-group">
        <label class="block text-sm font-medium text-gray-700 mb-1">{{
          "UserManagement.fullName" | translate
        }}</label>
        <div class="relative">
          <span
            class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"
          >
            <i class="fas fa-user"></i>
          </span>
          <input
            formControlName="fullName"
            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
            [placeholder]="'UserManagement.searchPlaceholder' | translate"
          />
        </div>
      </div>

      <!-- Email field -->
      <div class="form-group">
        <label class="block text-sm font-medium text-gray-700 mb-1">{{
          "UserManagement.email" | translate
        }}</label>
        <div class="relative">
          <span
            class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"
          >
            <i class="fas fa-envelope"></i>
          </span>
          <input
            formControlName="email"
            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
            [placeholder]="'UserManagement.emailPlaceholder' | translate"
          />
        </div>
      </div>

      <!-- Phone field -->
      <div class="form-group">
        <label class="block text-sm font-medium text-gray-700 mb-1">{{
          "UserManagement.phoneNumber" | translate
        }}</label>
        <div class="relative">
          <span
            class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"
          >
            <i class="fas fa-phone"></i>
          </span>
          <input
            formControlName="cellPhone"
            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
            [placeholder]="'UserManagement.phonePlaceholder' | translate"
          />
        </div>
      </div>

      <!-- Account status -->
      <div class="form-group">
        <label class="block text-sm font-medium text-gray-700 mb-1">{{
          "UserManagement.status" | translate
        }}</label>
        <div class="relative">
          <span
            class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"
          >
            <i class="fas fa-toggle-on"></i>
          </span>
          <select
            formControlName="status"
            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary appearance-none transition-colors"
          >
            <option [ngValue]="null">
              {{ "UserManagement.allStatuses" | translate }}
            </option>
            <option *ngFor="let status of listStatus" [value]="status.value">
              {{ status.label }}
            </option>
          </select>
          <span
            class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400"
          >
            <i class="fas fa-chevron-down text-xs"></i>
          </span>
        </div>
      </div>

      <!-- User role -->
      <div class="form-group">
        <label class="block text-sm font-medium text-gray-700 mb-1">{{
          "UserManagement.role" | translate
        }}</label>
        <div class="relative">
          <span
            class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"
          >
            <i class="fas fa-user-shield"></i>
          </span>
          <select
            formControlName="roles"
            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary appearance-none transition-colors"
          >
            <option [ngValue]="null">
              {{ "UserManagement.allRoles" | translate }}
            </option>
            <option *ngFor="let role of listRoles" [value]="role.value">
              {{ role.label }}
            </option>
          </select>
          <span
            class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400"
          >
            <i class="fas fa-chevron-down text-xs"></i>
          </span>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="form-group flex items-end gap-3">
        <button
          (click)="handleCancel()"
          class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex-1 flex items-center justify-center gap-1"
        >
          <i class="fas fa-times"></i>
          <span>{{ "UserManagement.reset" | translate }}</span>
        </button>
        <button
          (click)="handleSearch()"
          class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors flex-1 flex items-center justify-center gap-1"
        >
          <i class="fas fa-search"></i>
          <span>{{ "UserManagement.search" | translate }}</span>
        </button>
      </div>
    </form>
  </div>
  <!-- Users Data Table -->
  <div
    class="bg-white rounded-xl shadow-lg overflow-hidden transition-all hover:shadow-xl"
  >
    <!-- Table Header -->
    <div class="bg-gray-50 p-6 border-b border-gray-100">
      <div class="flex flex-wrap items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-800 flex items-center">
          <i class="fas fa-list-ul text-primary mr-2"></i>
          <span>{{ "Management.userList" | translate }}</span>
        </h2>
        <!-- Stats and pagination info -->
        <div class="flex items-center text-sm text-gray-500 mt-2 md:mt-0">
          <span
            >{{ "Statistics.users" | translate }}:
            <strong class="text-primary">{{ totalCount }}</strong></span
          >
          <span class="mx-2">|</span>
          <span
            >Page {{ params.page }} /
            {{ math.ceil(totalCount / params.pageSize) }}</span
          >
        </div>
      </div>
    </div>
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex items-center justify-center p-12">
      <div class="relative">
        <div
          class="h-16 w-16 rounded-full border-4 border-t-primary border-r-primary border-b-gray-200 border-l-gray-200 animate-spin"
        ></div>
        <div class="mt-4 text-center text-gray-500">Loading data...</div>
      </div>
    </div>

    <!-- Table Content -->
    <div *ngIf="!isLoading" class="overflow-x-auto">
      <table class="min-w-full">
        <thead>
          <tr class="bg-gray-50 text-left">
            <th
              class="py-4 px-6 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-16"
            >
              {{ "UserManagement.serialNumber" | translate }}
            </th>
            <th
              class="py-4 px-6 text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.fullName" | translate }}
            </th>
            <th
              class="py-4 px-6 text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.username" | translate }}
            </th>
            <th
              class="py-4 px-6 text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.email" | translate }}
            </th>
            <th
              class="py-4 px-6 text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.phoneNumber" | translate }}
            </th>
            <th
              class="py-4 px-6 text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.dateOfBirth" | translate }}
            </th>
            <th
              class="py-4 px-6 text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.address" | translate }}
            </th>
            <th
              class="py-4 px-6 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.status" | translate }}
            </th>
            <th
              class="py-4 px-6 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              {{ "UserManagement.actions" | translate }}
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100 bg-white">
          <tr
            *ngFor="let row of listUserManagements; let index = index"
            class="hover:bg-gray-50 transition-colors"
          >
            <td class="py-4 px-6 text-center whitespace-nowrap">
              <div class="flex justify-center">
                <span
                  class="h-7 w-7 flex items-center justify-center rounded-full bg-primary bg-opacity-10 text-primary font-medium text-sm"
                >
                  {{ index + 1 + (params.page - 1) * params.pageSize }}
                </span>
              </div>
            </td>
            <td class="py-4 px-6 whitespace-nowrap">
              <div
                (click)="handleDetail(row?.id)"
                class="font-medium text-gray-900 hover:text-primary hover:underline cursor-pointer transition-colors"
              >
                {{ row.fullname }}
              </div>
            </td>
            <td class="py-4 px-6 whitespace-nowrap">
              <div class="text-gray-700">{{ row.userName }}</div>
            </td>
            <td class="py-4 px-6 whitespace-nowrap">
              <div class="text-gray-700">{{ row.email }}</div>
            </td>
            <td class="py-4 px-6 whitespace-nowrap">
              <div class="text-gray-700">{{ row.cellPhone }}</div>
            </td>
            <td class="py-4 px-6 whitespace-nowrap">
              <div class="text-gray-700">
                {{ row.birthday | date: "dd/MM/yyyy" }}
              </div>
            </td>
            <td class="py-4 px-6">
              <div
                class="text-gray-700 truncate max-w-[180px]"
                title="{{ row.address }}"
              >
                {{ row.address }}
              </div>
            </td>
            <td class="py-4 px-6 text-center whitespace-nowrap">
              <span
                *ngIf="row.status === 'Active'"
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
              >
                <span
                  class="w-1.5 h-1.5 mr-1.5 rounded-full bg-green-500"
                ></span>
                {{ "UserManagement.active" | translate }}
              </span>
              <span
                *ngIf="row.status === 'Disable'"
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"
              >
                <span class="w-1.5 h-1.5 mr-1.5 rounded-full bg-red-500"></span>
                {{ "UserManagement.inactive" | translate }}
              </span>
            </td>
            <td class="py-4 px-6 text-center whitespace-nowrap">
              <button
                (click)="openDisablePopup(row?.id, row?.userName, row?.status)"
                class="text-gray-600 hover:text-primary p-1 rounded transition-colors"
                [title]="
                  row.status === 'Active'
                    ? ('UserManagement.disable' | translate)
                    : ('UserManagement.enable' | translate)
                "
              >
                <i
                  *ngIf="row.status === 'Active'"
                  class="fas fa-user-slash text-red-500 text-lg"
                ></i>
                <i
                  *ngIf="row.status === 'Disable'"
                  class="fas fa-user-check text-green-500 text-lg"
                ></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State when no data -->
    <div
      *ngIf="
        !isLoading && (!listUserManagements || listUserManagements.length === 0)
      "
      class="text-center py-12"
    >
      <div class="mx-auto h-24 w-24 text-gray-300 mb-4">
        <i class="fas fa-users text-6xl"></i>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">
        {{ "UserManagement.noUsers" | translate }}
      </h3>
      <p class="text-gray-500">
        {{ "UserManagement.noUsersDescription" | translate }}
      </p>
    </div>

    <!-- Pagination -->
    <div
      *ngIf="
        !isLoading && listUserManagements && listUserManagements.length > 0
      "
      class="bg-gray-50 px-6 py-4 border-t"
    >
      <div class="flex items-center justify-between">
        <div class="text-sm text-gray-700">
          <span
            >{{ "UserManagement.showing" | translate }}
            <strong>{{ (params.page - 1) * params.pageSize + 1 }}</strong>
            {{ "UserManagement.to" | translate }}
            <strong>{{
              math.min(params.page * params.pageSize, totalCount)
            }}</strong>
            {{ "UserManagement.of" | translate }}
            <strong>{{ totalCount }}</strong>
            {{ "UserManagement.results" | translate }}</span
          >
        </div>
        <div class="flex items-center space-x-2">
          <button
            (click)="changePage(params.page - 1)"
            [disabled]="params.page === 1"
            class="px-3 py-1 rounded border bg-white text-gray-600 disabled:opacity-50"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="px-3 py-1 text-sm text-gray-700"
            >{{ params.page }} /
            {{ math.ceil(totalCount / params.pageSize) }}</span
          >
          <button
            (click)="changePage(params.page + 1)"
            [disabled]="params.page >= math.ceil(totalCount / params.pageSize)"
            class="px-3 py-1 rounded border bg-white text-gray-600 disabled:opacity-50"
          >
            <i class="fas fa-chevron-right"></i>
          </button>

          <select
            [(ngModel)]="params.pageSize"
            (ngModelChange)="changePageSize($event)"
            class="ml-4 px-2 py-1 border rounded"
          >
            <option [ngValue]="5">
              5 {{ "UserManagement.itemsPerPage" | translate }}
            </option>
            <option [ngValue]="10">
              10 {{ "UserManagement.itemsPerPage" | translate }}
            </option>
            <option [ngValue]="20">
              20 {{ "UserManagement.itemsPerPage" | translate }}
            </option>
            <option [ngValue]="50">
              50 {{ "UserManagement.itemsPerPage" | translate }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Management Add Modal -->
<app-management-add
  *ngIf="isVisiblePopUpAddManagement"
  [isVisiblePopUpAddManagement]="isVisiblePopUpAddManagement"
  [idManagement]="idManagement"
  [mode]="mode"
  (visiblePopUpAddManagement)="handelVisiblePopUpAddManagement($event)"
></app-management-add>

<!-- Account Disable Modal -->
<app-account-disable
  [isVisible]="isVisible"
  [idManagement]="idManagement"
  [nameManagement]="nameManagement"
  (changeVisibleDelete)="handleChangeVisible($event)"
></app-account-disable>
