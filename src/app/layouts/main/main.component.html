<nz-layout class="min-h-full">
  <nz-sider nzCollapsible [(nzCollapsed)]="isCollapsed" [class.hidden]="isCollapsed" [class.lg:block]="isCollapsed"
    [nzWidth]="width" nzTheme="light" [nzTrigger]="null" [nzReverseArrow]="isReverseArrow"
    class="main-sidebar">
    
    <!-- Profile Section with Enhanced Design -->
    <div class="sidebar-profile-section p-6">
      <div [routerLink]="['/']" routerLinkActive="router-link-active"
        class="cursor-pointer flex flex-col items-center justify-center transition-all duration-300 hover:scale-105">
        
        <div class="relative mb-4">
          <img src="../../../assets/img/Hanu.jpeg" alt="User Avatar" 
               class="w-16 h-16 rounded-full border-4 border-white shadow-lg object-cover">
          <!-- Online Status Indicator -->
          <div class="absolute bottom-1 right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white shadow-sm animate-pulse"></div>
        </div>
        
        <div class="text-center">
          <h3 class="text-lg font-semibold text-gray-800 mb-1">{{userName}}</h3>
          <p class="text-sm text-gray-500">Administrator</p>
        </div>
      </div>
      
      <!-- Language Toggle with Enhanced Design -->
      <div class="absolute top-4 right-4">
        <div class="relative group">
          <div class="w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center cursor-pointer transition-all duration-300 hover:shadow-lg hover:scale-110">
            <span *ngIf="language==='vi'" (click)="changeLanguage('en')" 
                  class="text-xs font-bold text-blue-600 select-none">VN</span>
            <span *ngIf="language==='en'" (click)="changeLanguage('vi')" 
                  class="text-xs font-bold text-red-600 select-none">EN</span>
          </div>
          <!-- Tooltip -->
          <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
            {{ language === 'vi' ? 'Switch to English' : 'Chuyển sang Tiếng Việt' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Menu Container with Categories -->
    <div class="sidebar-menu-container">
      <!-- Admin Menu Section -->
      <div *ngIf="canActive">
        <div class="menu-category">
          <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">QUẢN TRỊ HỆ THỐNG</h4>
        </div>
        
        <ul nz-menu [nzMode]="'inline'" [nzInlineCollapsed]="isCollapsed" class="custom-menu">
          <li nz-menu-item [routerLink]="['/', 'statistical']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-chart-simple"></i>
              </div>
              <span class="menu-text">Thống kê</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'user-management']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-users"></i>
              </div>
              <span class="menu-text">{{'Menu.userManagement'| translate }}</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'slection-ticket']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-check-to-slot"></i>
              </div>
              <span class="menu-text">Tiến hành bầu cử</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'slection-follow']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-magnifying-glass-chart"></i>
              </div>
              <span class="menu-text">Theo dõi bầu cử</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'slection-management']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-sitemap"></i>
              </div>
              <span class="menu-text">Quản lý cuộc bầu cử</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'level-management']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-book-open-reader"></i>
              </div>
              <span class="menu-text">Quản lý chức vụ</span>
            </div>
          </li>
          
          <!-- Settings Submenu -->
          <ul nz-submenu nzTitle="{{'Menu.setting'| translate }}" nzIcon="setting">
            <li nz-menu-item [routerLink]="['/', 'user-infor',userInfor.sub]" nzMatchRouter>
              <div class="menu-item-content">
                <div class="menu-icon">
                  <i class="fa-regular fa-circle-user"></i>
                </div>
                <span class="menu-text">{{'Menu.userInfor'| translate }}</span>
              </div>
            </li>
            <li nz-menu-item [routerLink]="['/', 'setting']" nzMatchRouter>
              <div class="menu-item-content">
                <div class="menu-icon">
                  <i class="fa-solid fa-bullhorn"></i>
                </div>
                <span class="menu-text">Cài đặt hệ thống</span>
              </div>
            </li>
          </ul>
        </ul>
      </div>

      <!-- User Menu Section -->
      <div *ngIf="!canActive">
        <div class="menu-category">
          <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">NGƯỜI DÙNG</h4>
        </div>
        
        <ul nz-menu [nzMode]="'inline'" [nzInlineCollapsed]="isCollapsed" class="custom-menu">
          <li nz-menu-item [routerLink]="['/', 'statistical']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-chart-simple"></i>
              </div>
              <span class="menu-text">Thống kê</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'slection-ticket']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-check-to-slot"></i>
              </div>
              <span class="menu-text">Tiến hành bầu cử</span>
            </div>
          </li>
          
          <li nz-menu-item [routerLink]="['/', 'slection-follow']" nzMatchRouter>
            <div class="menu-item-content">
              <div class="menu-icon">
                <i class="fa-solid fa-magnifying-glass-chart"></i>
              </div>
              <span class="menu-text">Theo dõi bầu cử</span>
            </div>
          </li>
          
          <!-- Settings Submenu -->
          <ul nz-submenu nzTitle="{{'Menu.setting'| translate }}" nzIcon="setting">
            <li nz-menu-item [routerLink]="['/', 'user-infor',userInfor.sub]" nzMatchRouter>
              <div class="menu-item-content">
                <div class="menu-icon">
                  <i class="fa-regular fa-circle-user"></i>
                </div>
                <span class="menu-text">{{'Menu.userInfor'| translate }}</span>
              </div>
            </li>
            <li nz-menu-item [routerLink]="['/', 'setting']" nzMatchRouter>
              <div class="menu-item-content">
                <div class="menu-icon">
                  <i class="fa-solid fa-bullhorn"></i>
                </div>
                <span class="menu-text">Cài đặt hệ thống</span>
              </div>
            </li>
          </ul>
        </ul>
      </div>
    </div>

    <!-- Enhanced Footer with Logout Button -->
    <div class="sidebar-footer">
      <button class="logout-button" (click)="handleLogout()">
        <i class="fa-solid fa-sign-out-alt"></i>
        <span>Đăng xuất</span>
      </button>
    </div>
  </nz-sider>
  
  <nz-layout class="bg-gray-50" [ngClass]="{ 'ml-[280px]': !isCollapsed, 'lg:ml-[80px]': isCollapsed }">
    <nz-content>
      <div class="border-t border-solid border-primary px-4 py-4 h-full min-h-screen" 
           [class.hidden]="!isCollapsed" [class.lg:block]="!isCollapsed">
        <router-outlet></router-outlet>
      </div>
    </nz-content>
  </nz-layout>
</nz-layout>

<app-change-password *ngIf="isVisiblePopUpChangePassword"
[isVisiblePopUpChangePassword]="isVisiblePopUpChangePassword"
(visiblePopUpChangePassword)="handelVisiblePopUpChangePassword($event)"></app-change-password>